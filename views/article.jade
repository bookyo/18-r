extends layout

block content
  .container
    .row
      .col-md-3
        section.tags.clearfix
          a.tag.current(href="/") 全部
          each tag in tags 
            a.tag(href="/tag/#{tag._id}") #{tag.tag}
        section.hots
          h3.hot-title 一周影片热门榜
          div.list-group
            each hot,i in hots
              if i<5
                a.list-group-item(href="/movie/#{hot._id}") #{hot.title}
      .col-md-9.article
        h1 #{movie.title}
        .author
          a.author-info(href="/user/#{movie.creator._id}")
            img(src="/upload/avatar/avatar-#{movie.creator.avatar}.jpg" width="40" height="40")
            span #{movie.creator.name}
          span.pubdate 发表于 #{pubdate} &nbsp&nbsp
          span  已播放：#{movie.pv} 次
          .pull-right.admindo
            if user&&user.isadmin
              a(href="/movie/#{movie._id}/update") 修改
              button.btn.btn-danger.del(type="button", data-id="#{movie._id}") 删除
        .movie-main.clearfix
            .col-md-5
              img.img-responsive(src="/uploads/400/#{movie.img}")
            .col-md-7.movie-info
              dl.clearfix
                dt 导演:  
                dd #{movie.doctor}
              dl.clearfix
                dt 主演: 
                dd #{movie.players}
              dl.clearfix
                dt 电影类型: 
                dd
                  each type in movie.types
                    a(href="/tag/#{type._id}")
                      span.category #{type.tag}
              dl.clearfix
                dt 发行国家: 
                dd #{movie.country}
              dl.clearfix
                dt 上映年份: 
                dd #{movie.year}
              dl.clearfix
                dt  电影剧情简介: 
                - var summary = movie.summary;
                - var newsummary = summary.replace(/\r?\n/g,"<br />");
                dd.summary!= newsummary 
                dd.summary-hidden!=newsummary
        .col-md-12
            - var baidures = [];
            - var cilires = [];
            - var dianlvres = [];
            - var qihures = [];
            - var urlreg = /(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|&|-)+)/g;
            each resource in movie.resources
              if resource.typeid == 1
                - baidures.push(resource);
              else if resource.typeid == 2
                - cilires.push(resource);
              else if resource.typeid == 3
                - dianlvres.push(resource);
              else if resource.typeid == 4
                - qihures.push(resource);
            if baidures.length
              .panel.panel-default
                .panel-heading 百度云网盘资源
                ul.list-group
                  each baidure in baidures
                    - var baiduyun = baidure.resource.replace(urlreg,"<a href='$1$2' target='_blank'>$1$2</a>")
                    li.list-group-item!= baiduyun
            if cilires.length
              .panel.panel-default
                .panel-heading 磁力链接
                ul.list-group
                  each cilire in cilires
                    - var cili = cilire.resource.split('&')
                    li.list-group-item 
                      a(href="#{cili[0]}" target='_blank') 磁力链接
            if dianlvres.length
              .panel.panel-default
                .panel-heading 电驴ed2k链接
                ul.list-group
                  each dianlvre in dianlvres
                    - var dianlv = dianlvre.resource.split('|');
                    - var restitle = decodeURI(dianlv[2]);
                    li.list-group-item 
                      a(href="#{dianlvre.resource}" target='_blank')  #{restitle}
            if qihures.length
              .panel.panel-default
                .panel-heading 360云网盘资源
                ul.list-group
                  each qihure in qihures
                    - var qihu = qihure.resource.replace(urlreg,"<a href='$1$2' target='_blank'>$1$2</a>")
                    li.list-group-item!= qihu
            if user
              a.btn.btn-default.btn-block(href="/resource/#{movie._id}/add") 添加《#{movie.title}》的资源


          