extends layout

append head
  meta(name="keywords" content="#{topic.topic},#{topic.topic}下载")
  - var description = topic.summary.replace(/\r?\n/g,"").substring(0,100)
  meta(name="description" content="#{description}")

block content
  .container
    .row
      .col-md-3
        a.btn.btn-info.btn-topic(href="/topic/new") 创建电影专题
        section.hots
          h3.hot-title 热门专题推荐
          div.list-group
            each hottopic,i in hottopics
              a.list-group-item(href="/topic/#{hottopic._id}") #{hottopic.topic}
        section.notice
          h3.hot-title 全站公告
            if user && user.isadmin
              a.notice-btn.pull-right(href="/notice/add") 添加公告
          div.btn-group.text-center
            each notice in locals.notices
              a.btn.btn-default.btn-do(href="/notice/#{notice._id}") #{notice.title}
      .col-md-9
        section#main-body.clearfix
          .col-md-12.topic-body
            .topic-info
              h1 #{topic.topic}
              .author
                a.author-info(href="/user/#{topic.creator._id}")
                  img(src="/upload/avatar/avatar-#{topic.creator.avatar}.jpg" width="40" height="40")
                  span #{topic.creator.name}
                span.pubdate 发表于 #{pubdate}
                .pull-right.admindo
                  if user 
                    if user._id == topic.creator._id || user.isadmin
                      a(href="/topic/#{topic._id}/update") 修改
                  if user && user.isadmin
                    button.deltopic.btn.btn-danger(type="button", data-id="#{topic._id}") 删除
              - var newsummary = topic.summary.replace(/\r?\n/g,"<br />");
              p!= newsummary
            each movie in movies
              .movie-lists.clearfix
                .col-md-4.imgbox
                  a(href="/movie/#{movie._id}")
                    img.center-block.img-responsive(src="/uploads/400/#{movie.img}")
                .col-md-8.movieinfo
                  h2 
                    a(href="/movie/#{movie._id}") #{movie.title}
                    if user 
                      if user._id == topic.creator._id || user.isadmin
                        button.delmovie.pull-right.btn.btn-danger(type="button", data-movieid="#{movie._id}", data-topicid="#{topic._id}") 删除
                  dl
                    dt 导演：
                    dd #{movie.doctor}
                  dl 
                    dt 主演：
                    dd #{movie.players}
                  dl 
                    dt 电影类型：
                    dd
                      each type in movie.types
                        a(href="/tag/#{type._id}")
                          span.category #{type.tag}
                  dl.collec-summary
                    dt 电影剧情：
                    if movie.summary.length > 100
                      - var summary = movie.summary.substring(0,100)+ "..." ;
                      dd #{summary}
                    else
                      dd #{movie.summary}
                
        nav.pages
          if( pages> 1) 
            ul.pagination
              != createPagination(pages, page)